<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Foursquare Licensing Tracker - FOPT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    .screen { display: none; }
    .screen.active { display: block; }
    .reading-content { line-height: 2; font-size: 1.1rem; white-space: pre-wrap; }
    .reading-content p { margin-bottom: 1.5rem; text-indent: 2rem; }
    .lesson-content { line-height: 1.8; }
    .lesson-content ul { margin: 1rem 0; padding-left: 1.5rem; }
    .lesson-content li { margin-bottom: 0.5rem; }
    .key-point { background: #fef3c7; padding: 1rem; border-left: 4px solid #f59e0b; margin: 1rem 0; border-radius: 0 0.5rem 0.5rem 0; }
    .scripture { background: #dbeafe; padding: 0.75rem; border-radius: 0.5rem; font-style: italic; margin: 0.5rem 0; }
    .quiz-option { transition: all 0.2s; cursor: pointer; }
    .quiz-option:hover:not(:disabled) { transform: translateX(4px); }
    .quiz-option.selected { border-color: #3b82f6 !important; background: #eff6ff !important; }
    .quiz-option.correct { border-color: #10b981 !important; background: #d1fae5 !important; }
    .quiz-option.incorrect { border-color: #ef4444 !important; background: #fee2e2 !important; }
    .tab-btn { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 3px solid transparent; }
    .tab-btn.active { border-bottom-color: #3b82f6; color: #3b82f6; font-weight: 600; }
    .loading-spinner { border: 3px solid #e5e7eb; border-top-color: #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">

  <!-- LOGIN SCREEN -->
  <div id="screen-login" class="screen active">
    <div class="min-h-screen flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-8">
        <div class="text-center mb-8">
          <div class="w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
          </div>
          <h1 class="text-2xl font-bold text-slate-800">Foursquare Licensing</h1>
          <p class="text-slate-500 mt-2">Foundations of Pentecostal Theology</p>
        </div>

        <div id="login-form">
          <div class="mb-4">
            <label class="block text-sm font-medium text-slate-700 mb-1">Email</label>
            <input type="email" id="login-email" class="w-full border rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="your@email.com">
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
            <input type="password" id="login-password" class="w-full border rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <button id="btn-login" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-medium hover:opacity-90">Sign In</button>
          <p class="text-center text-sm text-slate-500 mt-4">Don't have an account? <span id="link-register" class="text-blue-600 hover:underline cursor-pointer">Create one</span></p>
        </div>

        <div id="register-form" style="display:none;">
          <div class="mb-4">
            <label class="block text-sm font-medium text-slate-700 mb-1">Full Name</label>
            <input type="text" id="reg-name" class="w-full border rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="John Smith">
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-slate-700 mb-1">Email</label>
            <input type="email" id="reg-email" class="w-full border rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="your@email.com">
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium text-slate-700 mb-1">Password (min 6 characters)</label>
            <input type="password" id="reg-password" class="w-full border rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <button id="btn-register" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-medium hover:opacity-90">Create Account</button>
          <p class="text-center text-sm text-slate-500 mt-4">Already have an account? <span id="link-login" class="text-blue-600 hover:underline cursor-pointer">Sign in</span></p>
        </div>

        <div id="login-error" class="hidden mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"></div>
        <div id="login-loading" class="hidden mt-4 text-center text-slate-500">
          <div class="inline-block w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"></div>
          Loading...
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="screen-app" class="screen">
    <header class="bg-gradient-to-r from-blue-900 to-indigo-900 text-white shadow-lg">
      <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
          </div>
          <div>
            <h1 class="text-lg font-bold">FOPT Study Guide</h1>
            <p class="text-blue-200 text-sm" id="user-greeting">Welcome!</p>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <span id="save-status" class="text-xs text-green-300 hidden">‚úì Saved</span>
          <button id="btn-logout" class="text-blue-200 hover:text-white text-sm">Sign Out</button>
        </div>
      </div>
    </header>
    <main class="max-w-6xl mx-auto px-4 py-6">
      <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-xl font-bold text-slate-800">Foundations of Pentecostal Theology</h2>
            <p class="text-sm text-slate-500">By Duffield & Van Cleave ‚Ä¢ Complete Book + 100 Quiz Questions</p>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold text-blue-600" id="overall-progress">0%</div>
            <div class="text-sm text-slate-500">Complete</div>
          </div>
        </div>
        <div class="w-full bg-slate-100 rounded-full h-3 mb-4">
          <div class="bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full transition-all" id="progress-bar" style="width:0%"></div>
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-4" id="domain-cards"></div>
    </main>
  </div>

  <!-- CHAPTER SCREEN (Tabs: Read Full / Study Guide / Quiz) -->
  <div id="screen-chapter" class="screen">
    <header class="bg-gradient-to-r from-blue-900 to-indigo-900 text-white shadow-lg">
      <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
        <button id="chapter-back" class="flex items-center gap-2 text-blue-200 hover:text-white">‚Üê Back</button>
        <div class="text-center">
          <div class="font-bold" id="chapter-title"></div>
        </div>
        <div id="chapter-progress-badge" class="text-sm text-blue-200"></div>
      </div>
    </header>
    <div class="bg-white border-b">
      <div class="max-w-5xl mx-auto flex">
        <button class="tab-btn active" data-tab="read" onclick="switchTab('read')">üìñ Read Full Chapter</button>
        <button class="tab-btn" data-tab="study" onclick="switchTab('study')">üìù Study Guide</button>
        <button class="tab-btn" data-tab="quiz" onclick="switchTab('quiz')">‚úÖ Take Quiz</button>
      </div>
    </div>
    <main class="max-w-5xl mx-auto px-4 py-6">
      <!-- READ TAB -->
      <div id="tab-read" class="tab-content">
        <div id="reading-loading" class="text-center py-12">
          <div class="loading-spinner mx-auto mb-4"></div>
          <p class="text-slate-500">Loading full chapter...</p>
        </div>
        <div id="reading-content" class="bg-white rounded-xl shadow-sm border p-8 hidden">
          <div id="full-chapter-text" class="reading-content text-slate-700"></div>
        </div>
      </div>
      <!-- STUDY TAB -->
      <div id="tab-study" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <div id="study-lessons"></div>
          <div class="mt-6 pt-6 border-t flex justify-between">
            <button id="study-prev" class="px-6 py-3 border rounded-lg text-slate-600 hover:bg-slate-50 hidden">‚Üê Previous</button>
            <button id="study-next" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 ml-auto">Next ‚Üí</button>
          </div>
        </div>
      </div>
      <!-- QUIZ TAB -->
      <div id="tab-quiz" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-sm border p-6">
          <div id="quiz-container">
            <div class="text-sm text-slate-500 mb-2" id="quiz-counter"></div>
            <div id="quiz-question" class="text-xl font-medium text-slate-800 mb-6"></div>
            <div id="quiz-options" class="space-y-3"></div>
            <div id="quiz-feedback" class="hidden mt-6 p-4 rounded-lg"></div>
            <div class="mt-6 flex justify-end">
              <button id="quiz-submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50" disabled>Check Answer</button>
              <button id="quiz-next" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 hidden">Next ‚Üí</button>
            </div>
          </div>
          <div id="quiz-results" class="hidden text-center py-8">
            <div id="results-icon" class="text-6xl mb-4">üéâ</div>
            <h2 class="text-2xl font-bold text-slate-800 mb-2" id="results-title"></h2>
            <p class="text-slate-600 mb-6" id="results-message"></p>
            <div class="flex justify-center gap-4 mb-6">
              <div class="bg-green-50 rounded-xl p-4"><div class="text-3xl font-bold text-green-600" id="results-correct">0</div><div class="text-sm text-green-700">Correct</div></div>
              <div class="bg-red-50 rounded-xl p-4"><div class="text-3xl font-bold text-red-600" id="results-incorrect">0</div><div class="text-sm text-red-700">Incorrect</div></div>
              <div class="bg-blue-50 rounded-xl p-4"><div class="text-3xl font-bold text-blue-600" id="results-percent">0%</div><div class="text-sm text-blue-700">Score</div></div>
            </div>
            <div class="flex justify-center gap-4">
              <button onclick="retakeQuiz()" class="px-6 py-3 border rounded-lg text-slate-600 hover:bg-slate-50">Retake Quiz</button>
              <button onclick="backToApp()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Back to Chapters</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

<script>
// SIMPLE TOGGLE
(function() {
  var linkReg = document.getElementById('link-register');
  var linkLog = document.getElementById('link-login');
  var formLogin = document.getElementById('login-form');
  var formReg = document.getElementById('register-form');
  if (linkReg) { linkReg.onclick = function() { formLogin.style.display = 'none'; formReg.style.display = 'block'; }; }
  if (linkLog) { linkLog.onclick = function() { formReg.style.display = 'none'; formLogin.style.display = 'block'; }; }
})();

// Load Supabase
var supabase = null;
var SUPABASE_URL = 'https://mvuvgecqxwuqfshqbtjf.supabase.co';
var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12dXZnZWNxeHd1cWZzaHFidGpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwODQ4MTUsImV4cCI6MjA4MzY2MDgxNX0.6OezNuwN5Ip2a_Xw_SsuxoB80nn3WP7D5dnhAEE9A9o';

function initSupabase() {
  if (window.supabase && window.supabase.createClient) {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    checkExistingSession();
  }
}
var script = document.createElement('script');
script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js';
script.onload = initSupabase;
document.head.appendChild(script);

// Loaded chapter content cache
var loadedChapters = {};

// CHAPTER DATA
var CHAPTERS = [
  {
    id: 'ch1', number: 1, name: 'Scripture', fullName: 'The Doctrine of Scripture (Bibliology)', icon: 'üìñ', color: 'from-amber-500 to-orange-600',
    description: 'The Bible\'s origin, inspiration, inerrancy, and authority.',
    studyGuide: [
      { title: 'Introduction', content: '<h3 class="text-xl font-bold mb-4">God Reveals Himself</h3><p>God does not remain silent. He takes pleasure in making Himself known. The greatest revelation is Jesus Christ, the Word Incarnate (John 1:1-14).</p><div class="scripture">"God, who at various times and in various ways spoke in time past to the fathers by the prophets, has in these last days spoken to us by His Son." ‚Äî Hebrews 1:1-2</div>' },
      { title: 'Names of the Bible', content: '<h3 class="text-xl font-bold mb-4">Names for God\'s Word</h3><ul><li><strong>Bible</strong> ‚Äî Greek "biblos" = book</li><li><strong>Scripture/Scriptures</strong> ‚Äî Holy writings</li><li><strong>The Word of God</strong> ‚Äî Mark 7:13, Hebrews 4:12</li><li><strong>The Oracles of God</strong> ‚Äî Romans 3:2</li></ul>' },
      { title: 'Divisions of Scripture', content: '<h3 class="text-xl font-bold mb-4">Structure of the Bible</h3><p><strong>Old Testament (39 books):</strong> Law (Torah), Prophets (Nebhiim), Writings (Kethbhim)</p><p><strong>New Testament (27 books):</strong> Gospels, Acts, Epistles, Revelation</p><div class="key-point">66 books, 40+ authors, 1,500+ years ‚Äî one unified message!</div>' },
      { title: 'Inspiration', content: '<h3 class="text-xl font-bold mb-4">God-Breathed</h3><div class="scripture">"All Scripture is given by inspiration of God (theopneustos)." ‚Äî 2 Timothy 3:16</div><p><strong>Verbal Plenary Inspiration:</strong> Every word (verbal) and all parts (plenary) are inspired by God.</p>' },
      { title: 'The Canon', content: '<h3 class="text-xl font-bold mb-4">The Authoritative Collection</h3><p>"Canon" = rule or standard. The church recognized (not created) which books God inspired.</p>' }
    ],
    quizzes: [
      {q: "What Greek word does 'Bible' come from?", options: ["Logos", "Biblos", "Theos", "Graphe"], correct: 1, explanation: "Bible comes from Greek 'biblos' meaning 'book.'"},
      {q: "How many books are in the Old Testament?", options: ["27", "39", "46", "66"], correct: 1, explanation: "The Old Testament contains 39 books."},
      {q: "How many books are in the New Testament?", options: ["21", "24", "27", "30"], correct: 2, explanation: "The New Testament contains 27 books."},
      {q: "What are the three divisions of the Hebrew Old Testament?", options: ["History, Poetry, Prophecy", "Law, Prophets, Writings", "Genesis, Psalms, Isaiah", "Torah, Gospels, Epistles"], correct: 1, explanation: "Torah (Law), Nebhiim (Prophets), Kethbhim (Writings)."},
      {q: "What does 'theopneustos' mean?", options: ["Holy book", "God-breathed", "Divine word", "Sacred text"], correct: 1, explanation: "'Theopneustos' means 'God-breathed' ‚Äî Scripture is inspired by God."},
      {q: "What is 'verbal plenary inspiration'?", options: ["Only ideas inspired", "Only NT inspired", "Every word inspired", "Only doctrine inspired"], correct: 2, explanation: "Every word (verbal) and all parts (plenary) are inspired."},
      {q: "What does 'canon' mean?", options: ["Weapon", "Rule or standard", "Scroll", "Temple"], correct: 1, explanation: "'Canon' means rule or standard ‚Äî the authoritative books."},
      {q: "How many authors wrote the Bible?", options: ["12", "27", "40+", "66"], correct: 2, explanation: "At least 40 different authors wrote the Bible."},
      {q: "Over what period was the Bible written?", options: ["100 years", "500 years", "1,000 years", "1,500+ years"], correct: 3, explanation: "The Bible was written over 1,500+ years."},
      {q: "2 Timothy 3:16 says:", options: ["God is love", "All Scripture is inspired", "Jesus saves", "Believe and be saved"], correct: 1, explanation: "'All Scripture is given by inspiration of God.'"}
    ]
  },
  {
    id: 'ch2', number: 2, name: 'God', fullName: 'The Doctrine of God (Theology)', icon: 'üëë', color: 'from-purple-500 to-violet-600',
    description: 'The nature, attributes, names, and Trinity of God.',
    studyGuide: [
      { title: 'Knowing God', content: '<h3 class="text-xl font-bold mb-4">The Knowable Unknown</h3><p>God is beyond full comprehension yet makes Himself knowable. "Let him who glories glory in this, that he understands and knows Me" (Jeremiah 9:24).</p>' },
      { title: 'Arguments for God', content: '<h3 class="text-xl font-bold mb-4">Evidence for God\'s Existence</h3><ul><li><strong>Cosmological</strong> ‚Äî Every effect needs a cause</li><li><strong>Teleological</strong> ‚Äî Design requires a Designer</li><li><strong>Moral</strong> ‚Äî Universal morality requires a Lawgiver</li><li><strong>Ontological</strong> ‚Äî The idea of perfection requires existence</li></ul>' },
      { title: 'Nature of God', content: '<h3 class="text-xl font-bold mb-4">Who God Is</h3><div class="scripture">"God is Spirit, and those who worship Him must worship in spirit and truth." ‚Äî John 4:24</div><p>God is Spirit, perfect, personal, and One.</p>' },
      { title: 'Names of God', content: '<h3 class="text-xl font-bold mb-4">God\'s Names Reveal His Character</h3><ul><li><strong>YHWH</strong> ‚Äî I AM, the covenant name</li><li><strong>Elohim</strong> ‚Äî Powerful Creator</li><li><strong>El Shaddai</strong> ‚Äî God Almighty</li><li><strong>Adonai</strong> ‚Äî Lord, Master</li></ul>' },
      { title: 'Attributes of God', content: '<h3 class="text-xl font-bold mb-4">God\'s Characteristics</h3><p><strong>Absolute:</strong> Self-existence, immutability, omnipresence, omniscience, omnipotence</p><p><strong>Moral:</strong> Holiness, love, righteousness, justice, truth, mercy, grace</p>' },
      { title: 'The Trinity', content: '<h3 class="text-xl font-bold mb-4">One God, Three Persons</h3><div class="key-point">Father, Son, and Holy Spirit ‚Äî three persons, one God, co-equal and co-eternal.</div><p>Evidence: Jesus\' baptism (Matt 3:16-17), Great Commission (Matt 28:19), Benediction (2 Cor 13:14).</p>' }
    ],
    quizzes: [
      {q: "John 4:24 says God is:", options: ["Love", "Spirit", "Light", "Holy"], correct: 1, explanation: "'God is Spirit, and those who worship Him must worship in spirit and truth.'"},
      {q: "The cosmological argument says:", options: ["Design needs designer", "Effect needs cause", "Morality needs lawgiver", "Being needs existence"], correct: 1, explanation: "Every effect needs a cause; the universe needs a First Cause."},
      {q: "'Omniscient' means:", options: ["All-powerful", "All-present", "All-knowing", "All-loving"], correct: 2, explanation: "Omniscient = all-knowing."},
      {q: "'Omnipresent' means:", options: ["All-powerful", "Present everywhere", "All-knowing", "Eternal"], correct: 1, explanation: "Omnipresent = present everywhere."},
      {q: "'Immutability' means God:", options: ["Is invisible", "Never changes", "Is infinite", "Is eternal"], correct: 1, explanation: "Immutability = God never changes."},
      {q: "How many persons in the Trinity?", options: ["One", "Two", "Three", "Four"], correct: 2, explanation: "Three: Father, Son, Holy Spirit."},
      {q: "Which is NOT an OT name for God?", options: ["Elohim", "YHWH", "El Shaddai", "Christos"], correct: 3, explanation: "Christos (Christ) is Greek NT; others are Hebrew OT."},
      {q: "The teleological argument is:", options: ["Cause and effect", "Design needs Designer", "Moral law", "Perfect being"], correct: 1, explanation: "Design in creation requires an intelligent Designer."},
      {q: "The Holy Spirit is:", options: ["A force", "A Person of the Trinity", "An angel", "A symbol"], correct: 1, explanation: "The Holy Spirit is the third Person of the Trinity."},
      {q: "Jesus Christ is:", options: ["Only human", "Only divine", "Fully God and man", "Half and half"], correct: 2, explanation: "Jesus is fully God and fully man."}
    ]
  },
  {
    id: 'ch3', number: 3, name: 'Humanity', fullName: 'The Doctrine of Humankind (Anthropology)', icon: 'üë§', color: 'from-green-500 to-emerald-600',
    description: 'Human origin, nature, image of God, and purpose.',
    studyGuide: [
      { title: 'Created by God', content: '<h3 class="text-xl font-bold mb-4">Special Creation</h3><div class="scripture">"So God created man in His own image; in the image of God He created him; male and female He created them." ‚Äî Genesis 1:27</div><p>Humans exist by special creation, not evolution from lower forms.</p>' },
      { title: 'Image of God', content: '<h3 class="text-xl font-bold mb-4">Imago Dei</h3><p>Not physical (God is Spirit). The image includes:</p><ul><li><strong>Personal</strong> ‚Äî Intellect, emotion, will</li><li><strong>Moral</strong> ‚Äî Conscience, right and wrong</li><li><strong>Spiritual</strong> ‚Äî Capacity for God</li></ul>' },
      { title: 'Constitution of Humans', content: '<h3 class="text-xl font-bold mb-4">Body, Soul, Spirit</h3><div class="scripture">"May your whole spirit, soul, and body be preserved blameless." ‚Äî 1 Thessalonians 5:23</div><p>Trichotomous: body, soul, spirit. Or Dichotomous: material and immaterial.</p>' },
      { title: 'Human Purpose', content: '<h3 class="text-xl font-bold mb-4">Why We Exist</h3><ul><li>Glorify God</li><li>Dominion over creation</li><li>Relationship with God and others</li><li>Reflect God\'s image</li></ul><div class="key-point">The soul is immortal ‚Äî our choices now affect our eternal destiny.</div>' }
    ],
    quizzes: [
      {q: "'Imago Dei' means:", options: ["Image of man", "Image of God", "Creation of God", "Child of God"], correct: 1, explanation: "Latin for 'Image of God.'"},
      {q: "1 Thessalonians 5:23 mentions:", options: ["Body and soul", "Body, soul, spirit", "Mind and body", "Heart and soul"], correct: 1, explanation: "'Spirit, soul, and body' ‚Äî trichotomous view."},
      {q: "Is God's image physical?", options: ["Yes", "No, personal/moral", "Only mind", "Only heart"], correct: 1, explanation: "God is Spirit; the image is personal and moral."},
      {q: "'Trichotomous' means:", options: ["Two parts", "Three parts", "One unified", "Four parts"], correct: 1, explanation: "Three parts: body, soul, spirit."},
      {q: "Why did God give free will?", options: ["To test", "For real relationship", "To cause sin", "No choice"], correct: 1, explanation: "Free will allows genuine love and relationship."},
      {q: "Human dignity comes from:", options: ["Accomplishments", "Image of God", "Intelligence", "Wealth"], correct: 1, explanation: "Being created in God's image."},
      {q: "The soul after death:", options: ["Ceases", "Sleeps", "Continues consciously", "Becomes angel"], correct: 2, explanation: "The soul continues consciously after death."},
      {q: "Humans were given:", options: ["Servant role", "Dominion over creation", "Equal to animals", "No role"], correct: 1, explanation: "Dominion (stewardship) over creation."},
      {q: "Which is NOT human personality?", options: ["Intellect", "Emotion", "Will", "Divinity"], correct: 3, explanation: "Humans have intellect, emotion, will ‚Äî not divinity."},
      {q: "Did humans evolve from lower forms?", options: ["Yes", "No", "Partially", "Only body"], correct: 1, explanation: "FOPT teaches special creation by God."}
    ]
  },
  {
    id: 'ch4', number: 4, name: 'Sin', fullName: 'The Doctrine of Sin (Hamartiology)', icon: '‚ö†Ô∏è', color: 'from-red-500 to-rose-600',
    description: 'The origin, nature, universality, and penalty of sin.',
    studyGuide: [
      { title: 'Origin of Sin', content: '<h3 class="text-xl font-bold mb-4">Where Sin Began</h3><p>Sin originated with Satan\'s rebellion, then entered humanity through Adam (Genesis 3).</p><div class="scripture">"How you are fallen from heaven, O Lucifer!" ‚Äî Isaiah 14:12</div>' },
      { title: 'Nature of Sin', content: '<h3 class="text-xl font-bold mb-4">What Sin Is</h3><ul><li><strong>Hamartia</strong> ‚Äî Missing the mark</li><li><strong>Parabasis</strong> ‚Äî Transgression</li><li><strong>Anomia</strong> ‚Äî Lawlessness</li></ul><p>Sin is rebellion against God, falling short of His glory.</p>' },
      { title: 'Universality of Sin', content: '<h3 class="text-xl font-bold mb-4">All Have Sinned</h3><div class="scripture">"For all have sinned and fall short of the glory of God." ‚Äî Romans 3:23</div><p><strong>Original Sin:</strong> Inherited sinful nature from Adam.</p><p><strong>Total Depravity:</strong> Sin affects every part of human nature.</p>' },
      { title: 'Penalty of Sin', content: '<h3 class="text-xl font-bold mb-4">Death</h3><div class="scripture">"The wages of sin is death." ‚Äî Romans 6:23</div><ul><li><strong>Spiritual Death</strong> ‚Äî Separation from God</li><li><strong>Physical Death</strong> ‚Äî Body dies</li><li><strong>Eternal Death</strong> ‚Äî Permanent separation</li></ul>' }
    ],
    quizzes: [
      {q: "Sin first originated with:", options: ["Adam/Eve", "Satan's rebellion", "Cain", "The flood"], correct: 1, explanation: "Sin began with Satan's rebellion before humanity."},
      {q: "Eve faced (1 John 2:16):", options: ["Money, power, fame", "Lust flesh, eyes, pride", "Fear, doubt, unbelief", "Anger, jealousy"], correct: 1, explanation: "Lust of flesh, lust of eyes, pride of life."},
      {q: "'Hamartia' means:", options: ["Rebellion", "Missing the mark", "Evil deed", "Lawbreaking"], correct: 1, explanation: "Greek for 'missing the mark.'"},
      {q: "Romans 3:23:", options: ["Some sinned", "Only Adam", "All have sinned", "No sin"], correct: 2, explanation: "'All have sinned and fall short.'"},
      {q: "'Original sin' is:", options: ["Adam's sin only", "Inherited nature", "Worst sin", "Satan's sin"], correct: 1, explanation: "The inherited sinful nature from Adam."},
      {q: "'Total depravity' means:", options: ["As bad as possible", "Sin affects all parts", "Only some sin", "Total destruction"], correct: 1, explanation: "Sin affects every aspect of human nature."},
      {q: "Penalty for sin (Rom 6:23):", options: ["Sickness", "Poverty", "Death", "Loneliness"], correct: 2, explanation: "'The wages of sin is death.'"},
      {q: "Sin is primarily against:", options: ["Others", "Ourselves", "God", "Nature"], correct: 2, explanation: "Sin is primarily against God (Psalm 51:4)."},
      {q: "Who is exempt from sin?", options: ["Good people", "Leaders", "Only Jesus", "Babies"], correct: 2, explanation: "Jesus alone was sinless (Hebrews 4:15)."},
      {q: "Three types of death from sin:", options: ["Quick, slow, peaceful", "Spiritual, physical, eternal", "Young, old, sick", "Accident, natural, violent"], correct: 1, explanation: "Spiritual, physical, and eternal death."}
    ]
  },
  {
    id: 'ch5', number: 5, name: 'Salvation', fullName: 'The Doctrine of Salvation (Soteriology)', icon: '‚úùÔ∏è', color: 'from-blue-500 to-indigo-600',
    description: 'How God saves through Jesus Christ\'s death and resurrection.',
    studyGuide: [
      { title: 'Christ\'s Death', content: '<h3 class="text-xl font-bold mb-4">The Cross</h3><div class="scripture">"While we were still sinners, Christ died for us." ‚Äî Romans 5:8</div><ul><li><strong>Atonement</strong> ‚Äî Paid sin\'s penalty</li><li><strong>Substitution</strong> ‚Äî Died in our place</li><li><strong>Propitiation</strong> ‚Äî Satisfied God\'s wrath</li><li><strong>Redemption</strong> ‚Äî Purchased us</li><li><strong>Reconciliation</strong> ‚Äî Restored relationship</li></ul>' },
      { title: 'Resurrection', content: '<h3 class="text-xl font-bold mb-4">He Is Risen!</h3><div class="scripture">"If Christ is not risen, your faith is futile." ‚Äî 1 Corinthians 15:17</div><p>The resurrection proves Jesus is who He claimed, His sacrifice was accepted, and death is defeated.</p>' },
      { title: 'Grace and Faith', content: '<h3 class="text-xl font-bold mb-4">How We Are Saved</h3><div class="scripture">"By grace you have been saved through faith... not of works." ‚Äî Ephesians 2:8-9</div><p><strong>Grace</strong> = unmerited favor. <strong>Faith</strong> = trusting Christ alone. <strong>Repentance</strong> = turning from sin.</p>' },
      { title: 'Justification', content: '<h3 class="text-xl font-bold mb-4">Declared Righteous</h3><p>Justification: God\'s legal declaration that we are righteous through Christ.</p>' },
      { title: 'Regeneration', content: '<h3 class="text-xl font-bold mb-4">Born Again</h3><div class="scripture">"If anyone is in Christ, he is a new creation." ‚Äî 2 Corinthians 5:17</div>' },
      { title: 'Sanctification & Glorification', content: '<h3 class="text-xl font-bold mb-4">Past, Present, Future</h3><p><strong>Sanctification:</strong> Being set apart, growing in holiness (present).</p><p><strong>Glorification:</strong> Future completion with resurrection bodies.</p>' }
    ],
    quizzes: [
      {q: "Ephesians 2:8-9 says salvation is by:", options: ["Works", "Grace through faith", "Baptism", "Church"], correct: 1, explanation: "'By grace through faith... not of works.'"},
      {q: "'Substitutionary atonement' means:", options: ["Christ as example", "Christ in our place", "We die for sin", "Not needed"], correct: 1, explanation: "Christ died as our substitute."},
      {q: "'Propitiation' means:", options: ["Making God angry", "Satisfying God's wrath", "Ignoring sin", "Punishing sinners"], correct: 1, explanation: "Christ's sacrifice satisfied God's wrath."},
      {q: "'Justification' is:", options: ["Made sinless", "Declared righteous", "Becoming God", "Joining church"], correct: 1, explanation: "God's legal declaration of righteousness."},
      {q: "'Regeneration' is:", options: ["Healing", "New birth", "Church membership", "Baptism"], correct: 1, explanation: "The new birth ‚Äî new nature (John 3:3)."},
      {q: "'Sanctification' is:", options: ["Initial salvation", "Growing in holiness", "Final judgment", "Ritual"], correct: 1, explanation: "Being set apart, growing in Christlikeness."},
      {q: "Christ's victory is proved by:", options: ["Teachings", "Miracles", "Resurrection", "Popularity"], correct: 2, explanation: "The resurrection proves victory over death."},
      {q: "'Redemption' means:", options: ["Forgiven", "Purchased from slavery", "Baptized", "Healed"], correct: 1, explanation: "Christ purchased us from sin's slavery."},
      {q: "'Repentance' is:", options: ["Feeling sorry", "Turning from sin to God", "Going to church", "Baptism"], correct: 1, explanation: "Complete change ‚Äî turning from sin to God."},
      {q: "'Glorification' is:", options: ["Present sanctification", "Future completion", "Being famous", "Immediate heaven"], correct: 1, explanation: "Future final stage with resurrection bodies."}
    ]
  },
  {
    id: 'ch6', number: 6, name: 'Holy Spirit', fullName: 'The Doctrine of the Holy Spirit (Pneumatology)', icon: 'üïäÔ∏è', color: 'from-cyan-500 to-teal-600',
    description: 'The person, work, baptism, fruit, and gifts of the Spirit.',
    studyGuide: [
      { title: 'Person of the Spirit', content: '<h3 class="text-xl font-bold mb-4">Not a Force ‚Äî A Person</h3><p>The Holy Spirit is the third Person of the Trinity with intellect, emotion, and will. He teaches, guides, intercedes, and can be grieved.</p>' },
      { title: 'Work of the Spirit', content: '<h3 class="text-xl font-bold mb-4">What He Does</h3><div class="scripture">"He will convict the world of sin, righteousness, and judgment." ‚Äî John 16:8</div><p>Convicts, regenerates, indwells, seals, produces fruit, gives gifts, guides into truth.</p>' },
      { title: 'Baptism with the Spirit', content: '<h3 class="text-xl font-bold mb-4">Power for Witness</h3><div class="scripture">"You shall receive power when the Holy Spirit has come upon you; and you shall be witnesses." ‚Äî Acts 1:8</div><p>A distinct experience of empowerment. Initial evidence: speaking in tongues (Acts 2:4, 10:46, 19:6).</p>' },
      { title: 'Fruit of the Spirit', content: '<h3 class="text-xl font-bold mb-4">Character</h3><div class="scripture">"The fruit of the Spirit is love, joy, peace, patience, kindness, goodness, faithfulness, gentleness, self-control." ‚Äî Galatians 5:22-23</div>' },
      { title: 'Gifts of the Spirit', content: '<h3 class="text-xl font-bold mb-4">Supernatural Abilities</h3><p><strong>Revelation:</strong> Wisdom, knowledge, discernment</p><p><strong>Power:</strong> Faith, healings, miracles</p><p><strong>Vocal:</strong> Prophecy, tongues, interpretation</p><div class="key-point">Gifts for service; Fruit for character.</div>' }
    ],
    quizzes: [
      {q: "The Holy Spirit is:", options: ["A force", "God's power only", "Third Person of Trinity", "An angel"], correct: 2, explanation: "The Holy Spirit is the third Person of the Trinity."},
      {q: "John 16:8 ‚Äî Spirit convicts of:", options: ["Love, grace, mercy", "Sin, righteousness, judgment", "Faith, hope, love", "Past, present, future"], correct: 1, explanation: "Sin, righteousness, and judgment."},
      {q: "Purpose of Spirit baptism:", options: ["Salvation", "Sanctification", "Power for witness", "Forgiveness"], correct: 2, explanation: "'You shall receive power... witnesses' (Acts 1:8)."},
      {q: "Initial evidence of Spirit baptism:", options: ["Joy", "Prophecy", "Speaking in tongues", "Healing"], correct: 2, explanation: "FOPT teaches tongues as initial evidence."},
      {q: "How many fruit of the Spirit?", options: ["7", "9", "12", "3"], correct: 1, explanation: "Nine fruit listed in Galatians 5:22-23."},
      {q: "Spiritual gifts are in:", options: ["Matthew 5", "John 3", "1 Corinthians 12", "Revelation 1"], correct: 2, explanation: "1 Corinthians 12-14 details spiritual gifts."},
      {q: "Categories of gifts:", options: ["Big, medium, small", "Revelation, Power, Vocal", "Past, present, future", "Hebrew, Greek, Latin"], correct: 1, explanation: "Revelation, Power, Vocal gifts."},
      {q: "Spirit baptism is for:", options: ["Apostles only", "Pastors only", "All believers", "Mature only"], correct: 2, explanation: "The promise is for all believers (Acts 2:39)."},
      {q: "Which is fruit (not gift)?", options: ["Prophecy", "Healing", "Self-control", "Tongues"], correct: 2, explanation: "Self-control is fruit (Gal 5:23)."},
      {q: "The Spirit helps by:", options: ["Convicting only", "Guiding, teaching, reminding", "Power only", "Healing only"], correct: 1, explanation: "Guides, teaches, reminds of truth."}
    ]
  },
  {
    id: 'ch7', number: 7, name: 'Divine Healing', fullName: 'The Doctrine of Divine Healing', icon: 'üíö', color: 'from-lime-500 to-green-600',
    description: 'Healing in the atonement and available today through faith.',
    studyGuide: [
      { title: 'Healing in Atonement', content: '<h3 class="text-xl font-bold mb-4">Part of the Cross</h3><div class="scripture">"By His stripes we are healed." ‚Äî Isaiah 53:5</div><div class="scripture">"By whose stripes you were healed." ‚Äî 1 Peter 2:24</div><p>Divine healing is provided in Christ\'s atonement.</p>' },
      { title: 'Jesus the Healer', content: '<h3 class="text-xl font-bold mb-4">The Same Forever</h3><div class="scripture">"Jesus Christ is the same yesterday, today, and forever." ‚Äî Hebrews 13:8</div><p>Jesus healed all who came. His power hasn\'t changed.</p>' },
      { title: 'Healing in the Church', content: '<h3 class="text-xl font-bold mb-4">Instructions for Today</h3><div class="scripture">"Is anyone among you sick? Let him call for the elders of the church, and let them pray over him, anointing him with oil." ‚Äî James 5:14</div>' },
      { title: 'Faith and Healing', content: '<h3 class="text-xl font-bold mb-4">Trusting God</h3><p>Faith is important but not a formula. God is sovereign. Some healings are instant, some progressive. Medical treatment is not opposed to faith.</p>' }
    ],
    quizzes: [
      {q: "Isaiah 53:5 says:", options: ["God is love", "By His stripes we are healed", "Believe and be saved", "All have sinned"], correct: 1, explanation: "'By His stripes we are healed.'"},
      {q: "Hebrews 13:8 says Jesus is:", options: ["In heaven only", "Same yesterday, today, forever", "Different each age", "For Jews only"], correct: 1, explanation: "'The same yesterday, today, and forever.'"},
      {q: "James 5:14-15 says call:", options: ["Jesus only", "Faith healers", "Elders of church", "Doctors only"], correct: 2, explanation: "Call for elders to pray and anoint with oil."},
      {q: "What accompanies prayer (James 5)?", options: ["Fasting", "Anointing with oil", "Tongues", "Offering"], correct: 1, explanation: "Anointing with oil in the Lord's name."},
      {q: "Divine healing is:", options: ["Separate from atonement", "Part of atonement", "Apostolic times only", "Automatic"], correct: 1, explanation: "Healing is provided in the atonement."},
      {q: "Does healing negate medicine?", options: ["Yes, never use doctors", "No, both can be used", "Doctors only", "Medicine is sin"], correct: 1, explanation: "Both can be used together."},
      {q: "Healings are:", options: ["Always instant", "Always progressive", "Some instant, some progressive", "Never today"], correct: 2, explanation: "Some instant, some progressive."},
      {q: "Sickness entered through:", options: ["God's punishment", "Random chance", "The Fall and sin", "Evolution"], correct: 2, explanation: "Through the Fall and sin's effects."},
      {q: "Did healing continue after apostles?", options: ["No, stopped", "Yes, throughout history", "Sometimes", "Catholic only"], correct: 1, explanation: "Healing continued throughout church history."},
      {q: "Is faith a formula for healing?", options: ["Yes, guaranteed", "No, God is sovereign", "Not needed", "Healer's faith only"], correct: 1, explanation: "Faith matters but God remains sovereign."}
    ]
  },
  {
    id: 'ch8', number: 8, name: 'Church', fullName: 'The Doctrine of the Church (Ecclesiology)', icon: '‚õ™', color: 'from-orange-500 to-amber-600',
    description: 'The body of Christ: nature, leadership, ordinances, mission.',
    studyGuide: [
      { title: 'What is the Church?', content: '<h3 class="text-xl font-bold mb-4">Ekklesia = Called-Out Assembly</h3><p><strong>Universal Church:</strong> All believers everywhere</p><p><strong>Local Church:</strong> Believers in one place</p><div class="scripture">"Christ is head of the church, which is His body." ‚Äî Colossians 1:18</div>' },
      { title: 'Images of the Church', content: '<h3 class="text-xl font-bold mb-4">Biblical Pictures</h3><ul><li>Body of Christ</li><li>Bride of Christ</li><li>Temple of the Spirit</li><li>Family of God</li><li>Flock of the Shepherd</li></ul>' },
      { title: 'Leadership', content: '<h3 class="text-xl font-bold mb-4">Fivefold Ministry</h3><div class="scripture">"He gave some to be apostles, prophets, evangelists, pastors and teachers." ‚Äî Ephesians 4:11</div><p>Also: Elders, Bishops (overseers), Deacons</p>' },
      { title: 'Ordinances', content: '<h3 class="text-xl font-bold mb-4">Baptism & Lord\'s Supper</h3><p><strong>Baptism:</strong> By immersion; symbolizes death, burial, resurrection with Christ.</p><p><strong>Lord\'s Supper:</strong> Remembrance of Christ\'s sacrifice.</p>' },
      { title: 'Mission', content: '<h3 class="text-xl font-bold mb-4">Why We Exist</h3><div class="scripture">"Go make disciples of all nations." ‚Äî Matthew 28:19</div><p>Evangelism, discipleship, worship, fellowship, service.</p>' }
    ],
    quizzes: [
      {q: "'Ekklesia' means:", options: ["Building", "Called-out assembly", "Religious group", "Temple"], correct: 1, explanation: "'Called-out assembly.'"},
      {q: "Head of the church:", options: ["Pope", "Pastor", "Christ", "Elders"], correct: 2, explanation: "Christ is Head of the church."},
      {q: "Universal church is:", options: ["Largest denomination", "All believers everywhere", "Catholic only", "First church"], correct: 1, explanation: "All true believers everywhere."},
      {q: "NOT in Ephesians 4:11:", options: ["Apostle", "Prophet", "Deacon", "Evangelist"], correct: 2, explanation: "Deacon is not in the fivefold ministry."},
      {q: "Two ordinances:", options: ["Foot washing, fasting", "Baptism, Lord's Supper", "Tithing, prayer", "Confession, penance"], correct: 1, explanation: "Baptism and Lord's Supper."},
      {q: "Baptism symbolizes:", options: ["Washing sins", "Death, burial, resurrection", "Joining denomination", "Getting wet"], correct: 1, explanation: "Death, burial, resurrection with Christ."},
      {q: "The church is called:", options: ["Body of Christ", "Bride of Christ", "Temple of Spirit", "All of above"], correct: 3, explanation: "All of these are biblical images."},
      {q: "Church mission includes:", options: ["Worship only", "Evangelism only", "Evangelism, discipleship, worship, fellowship, service", "Politics"], correct: 2, explanation: "All five aspects."},
      {q: "Lord's Supper is:", options: ["Common meal", "Remembrance of sacrifice", "Easter only", "Optional"], correct: 1, explanation: "Remembrance of Christ's sacrifice."},
      {q: "Baptism should be:", options: ["Sprinkling", "Pouring", "By immersion", "Any method"], correct: 2, explanation: "FOPT teaches baptism by immersion."}
    ]
  },
  {
    id: 'ch9', number: 9, name: 'Angels', fullName: 'The Doctrine of Angels (Angelology)', icon: 'üëº', color: 'from-sky-500 to-blue-600',
    description: 'Holy angels, Satan, demons, and spiritual warfare.',
    studyGuide: [
      { title: 'Holy Angels', content: '<h3 class="text-xl font-bold mb-4">Ministering Spirits</h3><div class="scripture">"Are they not all ministering spirits sent to serve those who will inherit salvation?" ‚Äî Hebrews 1:14</div><p>Created beings with intellect, emotion, will. Innumerable and organized.</p>' },
      { title: 'Notable Angels', content: '<h3 class="text-xl font-bold mb-4">Named Angels</h3><p><strong>Michael:</strong> Archangel, warrior, leads God\'s armies</p><p><strong>Gabriel:</strong> Messenger, announced Christ\'s birth</p>' },
      { title: 'Satan', content: '<h3 class="text-xl font-bold mb-4">The Enemy</h3><p>Originally Lucifer, a high-ranking angel who rebelled (Isaiah 14, Ezekiel 28).</p><p><strong>Names:</strong> Devil, Dragon, Serpent, Adversary, Evil One</p><div class="key-point">Satan is real but NOT equal to God ‚Äî he is a defeated foe!</div>' },
      { title: 'Demons & Warfare', content: '<h3 class="text-xl font-bold mb-4">Fallen Angels</h3><p>Demons are angels who followed Satan. Believers have authority through Christ.</p><div class="scripture">"Submit to God. Resist the devil and he will flee." ‚Äî James 4:7</div>' }
    ],
    quizzes: [
      {q: "Are angels eternal?", options: ["Yes, always existed", "No, created beings", "Some are", "Bible doesn't say"], correct: 1, explanation: "Angels are created; only God is eternal."},
      {q: "Angels' role (Hebrews 1:14):", options: ["Judge us", "Minister to us", "Ignore us", "Test us"], correct: 1, explanation: "'Ministering spirits sent to serve.'"},
      {q: "Warrior archangel:", options: ["Gabriel", "Michael", "Lucifer", "Raphael"], correct: 1, explanation: "Michael leads heavenly armies."},
      {q: "Announced Christ's birth:", options: ["Michael", "Gabriel", "Raphael", "Uriel"], correct: 1, explanation: "Gabriel announced to Mary."},
      {q: "Lucifer was:", options: ["A demon", "A man", "High-ranking angel", "A god"], correct: 2, explanation: "A high-ranking angel who rebelled."},
      {q: "Demons are:", options: ["Dead spirits", "Fallen angels", "Imaginary", "Minor gods"], correct: 1, explanation: "Angels who followed Satan's rebellion."},
      {q: "Is Satan equal to God?", options: ["Yes, equals", "No, created being", "More powerful", "Brothers"], correct: 1, explanation: "Satan is created; not equal to almighty God."},
      {q: "NOT a name for Satan:", options: ["Devil", "Dragon", "Michael", "Adversary"], correct: 2, explanation: "Michael fights against Satan."},
      {q: "Believers have authority over Satan:", options: ["No authority", "Yes, through Christ", "Pastors only", "After death"], correct: 1, explanation: "Authority through Christ's victory."},
      {q: "Angels have:", options: ["Bodies only", "Intellect, emotion, will", "No personality", "Physical only"], correct: 1, explanation: "Personal beings with intellect, emotion, will."}
    ]
  },
  {
    id: 'ch10', number: 10, name: 'Last Things', fullName: 'The Doctrine of Last Things (Eschatology)', icon: 'üåÖ', color: 'from-indigo-500 to-purple-600',
    description: 'The return of Christ, rapture, tribulation, millennium, and eternity.',
    studyGuide: [
      { title: 'Second Coming', content: '<h3 class="text-xl font-bold mb-4">He Is Coming Again!</h3><div class="scripture">"This same Jesus... will so come in like manner." ‚Äî Acts 1:11</div><p>Personal, visible, bodily, imminent.</p>' },
      { title: 'The Rapture', content: '<h3 class="text-xl font-bold mb-4">Caught Up</h3><div class="scripture">"The dead in Christ will rise first. Then we who are alive... shall be caught up together with them in the clouds to meet the Lord in the air." ‚Äî 1 Thessalonians 4:16-17</div>' },
      { title: 'Tribulation', content: '<h3 class="text-xl font-bold mb-4">Seven Years</h3><p>Seven-year period of God\'s judgment. Rise of Antichrist. Battle of Armageddon.</p>' },
      { title: 'Millennium', content: '<h3 class="text-xl font-bold mb-4">Christ\'s 1,000-Year Reign</h3><div class="scripture">"They lived and reigned with Christ for a thousand years." ‚Äî Revelation 20:4</div><p><strong>Premillennialism:</strong> Christ returns BEFORE the Millennium.</p>' },
      { title: 'Eternal Destiny', content: '<h3 class="text-xl font-bold mb-4">Heaven and Hell</h3><p><strong>Heaven:</strong> Eternal life with God for believers.</p><p><strong>Hell:</strong> Eternal separation from God for unbelievers.</p><p><strong>New Heaven and Earth:</strong> Ultimate restoration (Revelation 21-22).</p><div class="key-point">No one knows when ‚Äî be ready!</div>' }
    ],
    quizzes: [
      {q: "The Rapture (1 Thess 4:16-17) is:", options: ["Death", "Caught up to meet Christ", "Final judgment", "New earth"], correct: 1, explanation: "'Caught up... to meet the Lord in the air.'"},
      {q: "Christ's return will be:", options: ["Invisible", "Personal, visible, bodily", "Symbolic", "Already happened"], correct: 1, explanation: "Personal, visible, bodily (Acts 1:11)."},
      {q: "Tribulation length:", options: ["3.5 years", "7 years", "10 years", "1,000 years"], correct: 1, explanation: "Seven-year period of judgment."},
      {q: "The Millennium is:", options: ["10 years", "100 years", "1,000-year reign", "Eternity"], correct: 2, explanation: "Christ's 1,000-year reign (Rev 20)."},
      {q: "Premillennialism says:", options: ["Christ after Millennium", "Christ before Millennium", "No Millennium", "In Millennium now"], correct: 1, explanation: "Christ returns before the Millennium."},
      {q: "Antichrist is:", options: ["Satan", "End-times world ruler", "Past emperor", "Symbol"], correct: 1, explanation: "Future world ruler opposing God."},
      {q: "Great White Throne is for:", options: ["Believers", "Angels", "Unbelievers", "Everyone"], correct: 2, explanation: "Judgment for unbelievers (Rev 20:11-15)."},
      {q: "Heaven is:", options: ["Temporary", "Eternal with God", "Reincarnation", "Soul sleep"], correct: 1, explanation: "Eternal life with God."},
      {q: "Timing of Christ's return:", options: ["We know date", "No one knows day/hour", "Already happened", "2030"], correct: 1, explanation: "'No one knows the day or hour' (Matt 24:36)."},
      {q: "Ultimate creation:", options: ["Nothing new", "New Heaven and Earth", "Just heaven", "Just earth"], correct: 1, explanation: "New Heaven and New Earth (Rev 21:1)."}
    ]
  }
];

// STATE
var currentUser = null;
var userProgress = null;
var currentChapter = null;
var currentTab = 'read';
var studyLessonIndex = 0;
var quizIndex = 0;
var selectedAnswer = null;
var quizScore = 0;

// HELPERS
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
  document.getElementById('screen-' + id).classList.add('active');
}
function showError(msg) { var el = document.getElementById('login-error'); el.textContent = msg; el.classList.remove('hidden'); }
function hideError() { document.getElementById('login-error').classList.add('hidden'); }
function showLoading(show) { document.getElementById('login-loading').classList.toggle('hidden', !show); }
function showSaveStatus() { var el = document.getElementById('save-status'); el.classList.remove('hidden'); setTimeout(function() { el.classList.add('hidden'); }, 2000); }
function createDefaultProgress() { var p = {}; CHAPTERS.forEach(function(c) { p[c.id] = { readComplete: false, studyComplete: false, quizScores: [], completed: false }; }); return p; }

// AUTH
async function handleRegister() {
  var name = document.getElementById('reg-name').value.trim();
  var email = document.getElementById('reg-email').value.trim();
  var password = document.getElementById('reg-password').value;
  if (!name || !email || !password) { showError('Please fill all fields'); return; }
  if (password.length < 6) { showError('Password must be at least 6 characters'); return; }
  if (!supabase) { showError('Connecting... try again.'); return; }
  hideError(); showLoading(true);
  try {
    var result = await supabase.auth.signUp({ email: email, password: password, options: { data: { name: name } } });
    if (result.error) throw result.error;
    if (result.data.user) { currentUser = result.data.user; userProgress = createDefaultProgress(); await saveProgress(); showApp(); }
  } catch (e) { showError(e.message); }
  showLoading(false);
}

async function handleLogin() {
  var email = document.getElementById('login-email').value.trim();
  var password = document.getElementById('login-password').value;
  if (!email || !password) { showError('Please fill all fields'); return; }
  if (!supabase) { showError('Connecting... try again.'); return; }
  hideError(); showLoading(true);
  try {
    var result = await supabase.auth.signInWithPassword({ email: email, password: password });
    if (result.error) throw result.error;
    currentUser = result.data.user; await loadProgress(); showApp();
  } catch (e) { showError(e.message); }
  showLoading(false);
}

async function handleLogout() { if (supabase) await supabase.auth.signOut(); currentUser = null; userProgress = null; showScreen('login'); }

async function loadProgress() {
  try {
    var result = await supabase.from('progress').select('data').eq('user_id', currentUser.id).single();
    if (result.data && result.data.data) { userProgress = result.data.data; } 
    else { userProgress = createDefaultProgress(); await saveProgress(); }
  } catch (e) { userProgress = createDefaultProgress(); }
  CHAPTERS.forEach(function(c) { if (!userProgress[c.id]) { userProgress[c.id] = { readComplete: false, studyComplete: false, quizScores: [], completed: false }; } });
}

async function saveProgress() {
  try { await supabase.from('progress').upsert({ user_id: currentUser.id, data: userProgress, updated_at: new Date().toISOString() }, { onConflict: 'user_id' }); showSaveStatus(); } 
  catch (e) { console.error('Save failed:', e); }
}

function checkExistingSession() {
  if (supabase) {
    supabase.auth.getSession().then(function(result) {
      if (result.data.session) { currentUser = result.data.session.user; loadProgress().then(function() { showApp(); }); }
    }).catch(function(e) { console.error(e); });
  }
}

// APP
function showApp() {
  showScreen('app');
  var name = 'Student';
  if (currentUser && currentUser.user_metadata && currentUser.user_metadata.name) { name = currentUser.user_metadata.name; }
  else if (currentUser && currentUser.email) { name = currentUser.email.split('@')[0]; }
  document.getElementById('user-greeting').textContent = 'Welcome, ' + name + '!';
  renderChapterCards();
  updateOverallProgress();
}

function backToApp() { showApp(); }

function renderChapterCards() {
  var html = '';
  CHAPTERS.forEach(function(c) {
    var p = userProgress[c.id];
    var complete = p.completed;
    var bestScore = p.quizScores.length > 0 ? Math.max.apply(null, p.quizScores) : 0;
    html += '<div class="bg-white rounded-xl shadow-sm border p-5 cursor-pointer hover:shadow-md transition-shadow" onclick="openChapter(\'' + c.id + '\')">';
    html += '<div class="flex items-center justify-between mb-3">';
    html += '<div class="flex items-center gap-3"><span class="text-2xl">' + c.icon + '</span>';
    html += '<div><h3 class="font-bold text-slate-800">Ch.' + c.number + ': ' + c.name + '</h3>';
    html += '<p class="text-xs text-slate-500">' + c.fullName + '</p></div></div>';
    if (complete) html += '<span class="text-green-500 text-xl">‚úì</span>';
    html += '</div>';
    html += '<p class="text-slate-500 text-sm mb-3">' + c.description + '</p>';
    html += '<div class="flex gap-2 text-xs">';
    html += '<span class="px-2 py-1 rounded ' + (p.readComplete ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500') + '">üìñ Read</span>';
    html += '<span class="px-2 py-1 rounded ' + (p.studyComplete ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500') + '">üìù Study</span>';
    html += '<span class="px-2 py-1 rounded ' + (bestScore >= 80 ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-500') + '">‚úÖ Quiz' + (bestScore > 0 ? ' (' + bestScore + '%)' : '') + '</span>';
    html += '</div></div>';
  });
  document.getElementById('domain-cards').innerHTML = html;
}

function updateOverallProgress() {
  var total = CHAPTERS.length;
  var done = 0;
  CHAPTERS.forEach(function(c) { if (userProgress[c.id].completed) done++; });
  var pct = Math.round((done/total)*100);
  document.getElementById('overall-progress').textContent = pct + '%';
  document.getElementById('progress-bar').style.width = pct + '%';
}

// CHAPTER VIEW
function openChapter(id) {
  currentChapter = CHAPTERS.find(function(c) { return c.id === id; });
  studyLessonIndex = 0;
  quizIndex = 0;
  quizScore = 0;
  selectedAnswer = null;
  showScreen('chapter');
  document.getElementById('chapter-title').textContent = 'Chapter ' + currentChapter.number + ': ' + currentChapter.fullName;
  updateChapterBadge();
  switchTab('read');
}

function updateChapterBadge() {
  var p = userProgress[currentChapter.id];
  var badge = '';
  if (p.completed) badge = '‚úì Complete';
  else if (p.quizScores.length > 0) badge = 'Best: ' + Math.max.apply(null, p.quizScores) + '%';
  document.getElementById('chapter-progress-badge').textContent = badge;
}

function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.tab === tab); });
  document.querySelectorAll('.tab-content').forEach(function(el) { el.classList.add('hidden'); });
  document.getElementById('tab-' + tab).classList.remove('hidden');
  
  if (tab === 'read') loadFullChapter();
  else if (tab === 'study') renderStudyLesson();
  else if (tab === 'quiz') startQuiz();
}

// FULL CHAPTER READING
function loadFullChapter() {
  var chId = currentChapter.id;
  document.getElementById('reading-loading').classList.remove('hidden');
  document.getElementById('reading-content').classList.add('hidden');
  
  if (loadedChapters[chId]) {
    displayFullChapter(loadedChapters[chId]);
  } else {
    var script = document.createElement('script');
    script.src = 'chapters/' + chId + '.js';
    script.onload = function() {
      var varName = 'FOPT_' + chId.toUpperCase();
      if (window[varName]) {
        loadedChapters[chId] = window[varName].content;
        displayFullChapter(loadedChapters[chId]);
      }
    };
    script.onerror = function() {
      document.getElementById('reading-loading').innerHTML = '<p class="text-red-500">Failed to load chapter. Make sure the chapters folder is uploaded.</p>';
    };
    document.head.appendChild(script);
  }
}

function displayFullChapter(content) {
  document.getElementById('reading-loading').classList.add('hidden');
  document.getElementById('reading-content').classList.remove('hidden');
  
  // Format the text with paragraphs
  var formatted = content.split('\n\n').map(function(p) {
    return '<p>' + p.trim().replace(/\n/g, '<br>') + '</p>';
  }).join('');
  
  document.getElementById('full-chapter-text').innerHTML = formatted;
  
  // Mark as read
  if (!userProgress[currentChapter.id].readComplete) {
    userProgress[currentChapter.id].readComplete = true;
    checkChapterComplete();
    saveProgress();
  }
}

// STUDY GUIDE
function renderStudyLesson() {
  var lessons = currentChapter.studyGuide;
  var lesson = lessons[studyLessonIndex];
  var html = '<div class="mb-4 text-sm text-slate-500">Lesson ' + (studyLessonIndex + 1) + ' of ' + lessons.length + '</div>';
  html += '<h2 class="text-2xl font-bold text-slate-800 mb-4">' + lesson.title + '</h2>';
  html += '<div class="lesson-content">' + lesson.content + '</div>';
  document.getElementById('study-lessons').innerHTML = html;
  
  document.getElementById('study-prev').classList.toggle('hidden', studyLessonIndex === 0);
  document.getElementById('study-next').textContent = studyLessonIndex === lessons.length - 1 ? 'Complete Study ‚Üí' : 'Next ‚Üí';
}

document.getElementById('study-prev').onclick = function() {
  if (studyLessonIndex > 0) { studyLessonIndex--; renderStudyLesson(); }
};

document.getElementById('study-next').onclick = function() {
  if (studyLessonIndex < currentChapter.studyGuide.length - 1) {
    studyLessonIndex++;
    renderStudyLesson();
  } else {
    if (!userProgress[currentChapter.id].studyComplete) {
      userProgress[currentChapter.id].studyComplete = true;
      checkChapterComplete();
      saveProgress();
    }
    switchTab('quiz');
  }
};

// QUIZ
function startQuiz() {
  quizIndex = 0;
  quizScore = 0;
  selectedAnswer = null;
  document.getElementById('quiz-container').classList.remove('hidden');
  document.getElementById('quiz-results').classList.add('hidden');
  renderQuizQuestion();
}

function renderQuizQuestion() {
  var q = currentChapter.quizzes[quizIndex];
  document.getElementById('quiz-counter').textContent = 'Question ' + (quizIndex + 1) + ' of ' + currentChapter.quizzes.length;
  document.getElementById('quiz-question').textContent = q.q;
  
  var letters = ['A', 'B', 'C', 'D'];
  var html = '';
  q.options.forEach(function(opt, i) {
    html += '<button class="quiz-option w-full p-4 border-2 rounded-lg text-left flex items-center gap-3" onclick="selectAnswer(' + i + ')" data-index="' + i + '">';
    html += '<span class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-bold">' + letters[i] + '</span>';
    html += '<span>' + opt + '</span></button>';
  });
  document.getElementById('quiz-options').innerHTML = html;
  document.getElementById('quiz-feedback').classList.add('hidden');
  document.getElementById('quiz-submit').classList.remove('hidden');
  document.getElementById('quiz-submit').disabled = true;
  document.getElementById('quiz-next').classList.add('hidden');
  selectedAnswer = null;
}

function selectAnswer(i) {
  selectedAnswer = i;
  document.querySelectorAll('.quiz-option').forEach(function(btn, idx) {
    btn.classList.toggle('selected', idx === i);
  });
  document.getElementById('quiz-submit').disabled = false;
}

document.getElementById('quiz-submit').onclick = function() {
  var q = currentChapter.quizzes[quizIndex];
  var correct = selectedAnswer === q.correct;
  if (correct) quizScore++;
  
  document.querySelectorAll('.quiz-option').forEach(function(btn) {
    var idx = parseInt(btn.dataset.index);
    btn.onclick = null;
    if (idx === q.correct) btn.classList.add('correct');
    else if (idx === selectedAnswer && !correct) btn.classList.add('incorrect');
  });
  
  var fb = document.getElementById('quiz-feedback');
  fb.classList.remove('hidden');
  fb.className = 'mt-6 p-4 rounded-lg ' + (correct ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200');
  fb.innerHTML = '<div class="font-medium ' + (correct ? 'text-green-800">‚úì Correct!' : 'text-red-800">‚úó Incorrect') + '</div><div class="text-sm mt-1">' + q.explanation + '</div>';
  
  document.getElementById('quiz-submit').classList.add('hidden');
  document.getElementById('quiz-next').classList.remove('hidden');
  document.getElementById('quiz-next').textContent = quizIndex === currentChapter.quizzes.length - 1 ? 'See Results' : 'Next ‚Üí';
};

document.getElementById('quiz-next').onclick = function() {
  if (quizIndex < currentChapter.quizzes.length - 1) {
    quizIndex++;
    renderQuizQuestion();
  } else {
    showQuizResults();
  }
};

async function showQuizResults() {
  var total = currentChapter.quizzes.length;
  var pct = Math.round((quizScore / total) * 100);
  var passed = pct >= 80;
  
  userProgress[currentChapter.id].quizScores.push(pct);
  if (passed) {
    userProgress[currentChapter.id].completed = true;
  }
  checkChapterComplete();
  await saveProgress();
  updateChapterBadge();
  
  document.getElementById('quiz-container').classList.add('hidden');
  document.getElementById('quiz-results').classList.remove('hidden');
  document.getElementById('results-icon').textContent = passed ? 'üéâ' : 'üìö';
  document.getElementById('results-title').textContent = passed ? 'Great Job!' : 'Keep Studying';
  document.getElementById('results-message').textContent = passed ? 'You passed Chapter ' + currentChapter.number + '!' : 'You need 80% to pass. Review and try again.';
  document.getElementById('results-correct').textContent = quizScore;
  document.getElementById('results-incorrect').textContent = total - quizScore;
  document.getElementById('results-percent').textContent = pct + '%';
}

function retakeQuiz() {
  startQuiz();
}

function checkChapterComplete() {
  var p = userProgress[currentChapter.id];
  var bestScore = p.quizScores.length > 0 ? Math.max.apply(null, p.quizScores) : 0;
  p.completed = p.readComplete && p.studyComplete && bestScore >= 80;
}

// EVENT LISTENERS
document.getElementById('btn-login').onclick = handleLogin;
document.getElementById('btn-register').onclick = handleRegister;
document.getElementById('btn-logout').onclick = handleLogout;
document.getElementById('chapter-back').onclick = backToApp;
</script>
</body>
</html>
